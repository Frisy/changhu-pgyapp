<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å±…å®¶é•¿æŠ¤ååŠ©ç”³è¯·ç³»ç»Ÿ - ç°åœºååŠ©ç”³è¯·ç™»è®°</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        
        :root {
            --primary-color: #2f80ed;
            --success-color: #52c41a;
            --warning-color: #faad14;
            --danger-color: #ff4d4f;
            --text-color: #333;
            --text-secondary: #666;
            --text-tertiary: #999;
            --border-color: #ddd;
            --bg-color: #f5f7fa;
        }
        
        body {
            background-color: var(--bg-color);
            font-size: 14px;
            color: var(--text-color);
            padding-bottom: 70px;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .nav-bar {
            height: 44px;
            line-height: 44px;
            background-color: var(--primary-color);
            color: #fff;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 999;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
        }
        
        .nav-back {
            font-size: 18px;
            cursor: pointer;
        }
        
        /* å†…å®¹å®¹å™¨ */
        .content {
            padding: 54px 15px 15px;
        }
        
        /* è¡¨å•åŒºåŸŸ */
        .form-section {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: var(--text-color);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: '';
            display: inline-block;
            width: 3px;
            height: 16px;
            background-color: var(--primary-color);
            margin-right: 8px;
            border-radius: 1px;
        }
        
        .form-item {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        
        .form-item:last-child {
            margin-bottom: 0;
        }
        
        .form-label {
            width: 90px;
            flex-shrink: 0;
            font-size: 14px;
            color: var(--text-color);
            padding-top: 10px;
            font-weight: 500;
        }
        
        .form-label.required::after {
            content: '*';
            color: var(--danger-color);
            margin-left: 2px;
        }
        
        .form-content {
            flex: 1;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background-color: #fff;
            transition: all 0.3s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(47, 128, 237, 0.1);
        }
        
        .form-input {
            height: 40px;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-input:read-only {
            background-color: #f5f7fa;
            color: var(--text-secondary);
        }
        
        /* èº«ä»½è¯è¯†åˆ«æŒ‰é’® */
        .id-card-scan {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .scan-btn {
            padding: 6px 12px;
            background-color: var(--primary-color);
            color: #fff;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            white-space: nowrap;
        }
        
        .scan-btn:active {
            opacity: 0.8;
        }
        
        /* å•é€‰å’Œå¤é€‰æ¡†ç»„ */
        .radio-group, .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .radio-item, .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .radio-item input[type="radio"],
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .radio-item label,
        .checkbox-item label {
            font-size: 14px;
            color: var(--text-color);
            cursor: pointer;
        }
        
        /* åœ°ç†ä½ç½®åŒºåŸŸ */
        .location-section {
            background-color: #f0f7ff;
            border: 1px solid #b3d8ff;
            border-radius: 6px;
            padding: 12px;
        }
        
        .location-info {
            margin-bottom: 10px;
        }
        
        .location-item {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .location-item strong {
            color: var(--text-color);
            margin-right: 5px;
        }
        
        .location-confirm {
            padding: 8px 16px;
            background-color: var(--success-color);
            color: #fff;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            border: none;
            margin-top: 10px;
        }
        
        .location-confirm:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .location-confirmed {
            color: var(--success-color);
            font-size: 12px;
            margin-top: 8px;
        }
        
        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .upload-section {
            margin-top: 15px;
        }
        
        .upload-tips {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 10px;
        }
        
        .upload-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .upload-item {
            position: relative;
            border: 1px dashed var(--border-color);
            border-radius: 8px;
            background-color: #fafafa;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .upload-item:hover {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }
        
        .upload-item.uploaded {
            border: 1px solid var(--success-color);
            background-color: #f6ffed;
        }
        
        .upload-item-header {
            padding: 8px;
            background-color: #fff;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-color);
            text-align: center;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-item-body {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background-color: #fafafa;
        }
        
        .upload-item.add-btn .upload-item-body::before {
            content: '+';
            font-size: 36px;
            color: var(--primary-color);
            font-weight: 300;
        }
        
        .upload-item.add-btn .upload-item-body::after {
            content: 'ç‚¹å‡»ä¸Šä¼ ';
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: var(--text-tertiary);
        }
        
        .upload-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .upload-item .delete-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background-color: rgba(255, 77, 79, 0.9);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .upload-item .delete-btn:active {
            transform: scale(0.9);
        }
        
        .upload-item .file-status {
            position: absolute;
            bottom: 4px;
            left: 4px;
            right: 4px;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            color: #fff;
            font-size: 10px;
            padding: 4px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .upload-item .optional-tag {
            position: absolute;
            top: 4px;
            left: 4px;
            background-color: rgba(250, 173, 20, 0.9);
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            z-index: 10;
        }
        
        .upload-item .yang-need-tag {
            position: absolute;
            top: 4px;
            left: 4px;
            background-color: rgba(47, 128, 237, 0.9);
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            z-index: 10;
        }
        
        /* æ¡£æ¡ˆææ–™åˆ†ç±» */
        .archive-category {
            margin-bottom: 20px;
        }
        
        .category-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 10px;
            padding-left: 8px;
            border-left: 3px solid var(--primary-color);
        }
        
        .category-tips {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 10px;
            padding-left: 8px;
        }
        
        /* åº•éƒ¨æŒ‰é’®æ  */
        .btn-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #fff;
            padding: 10px 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            z-index: 998;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
        }
        
        .btn-cancel {
            background-color: #f5f5f5;
            color: var(--text-secondary);
        }
        
        .btn-cancel:active {
            background-color: #e8e8e8;
        }
        
        .btn-submit {
            background-color: var(--primary-color);
            color: #fff;
        }
        
        .btn-submit:active {
            background-color: #096dd9;
        }
        
        .btn-submit:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* æç¤ºæ¡† */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.7);
            color: #fff;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            visibility: visible;
        }
        
        /* éšè—çš„æ–‡ä»¶è¾“å…¥ */
        .file-input {
            display: none;
        }
        
        /* åŠ è½½æç¤º */
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-tertiary);
        }
        
        /* åˆ—è¡¨é¡µé¢æ ·å¼ */
        .list-page {
            display: block;
        }
        
        .list-page.hidden {
            display: none;
        }
        
        .form-page {
            display: none;
        }
        
        .form-page.show {
            display: block;
        }
        
        /* ç­›é€‰åŒºåŸŸ */
        .filter-bar {
            background-color: #fff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .filter-item {
            flex: 1;
            min-width: 120px;
        }
        
        .filter-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: block;
        }
        
        .filter-input, .filter-select {
            width: 100%;
            height: 34px;
            padding: 0 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 13px;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            border: none;
        }
        
        .btn-reset {
            background-color: #f5f5f5;
            color: var(--text-secondary);
        }
        
        /* çº¿ç´¢åˆ—è¡¨ */
        .clue-list {
            background-color: #fff;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .list-header {
            display: flex;
            padding: 10px 12px;
            border-bottom: 1px solid #f5f5f5;
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 500;
        }
        
        .list-item {
            display: flex;
            padding: 12px;
            border-bottom: 1px solid #f5f5f5;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .list-item:hover {
            background-color: #f9f9f9;
        }
        
        .list-item:active {
            background-color: #f0f0f0;
        }
        
        .col-date {
            width: 10%;
            flex-shrink: 0;
        }
        
        .col-name {
            width: 8%;
            flex-shrink: 0;
        }
        
        .col-family {
            width: 8%;
            flex-shrink: 0;
        }
        
        .col-community {
            width: 12%;
            flex-shrink: 0;
        }
        
        .col-address {
            width: 20%;
            flex-shrink: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .col-phone {
            width: 12%;
            flex-shrink: 0;
        }
        
        .col-source {
            width: 10%;
            flex-shrink: 0;
        }
        
        .col-action {
            width: 20%;
            flex-shrink: 0;
            text-align: center;
        }
        
        .select-btn {
            padding: 6px 16px;
            background-color: var(--primary-color);
            color: #fff;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            border: none;
        }
        
        .select-btn:active {
            opacity: 0.8;
        }
        
        /* ç©ºæ•°æ®æç¤º */
        .empty-data {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-tertiary);
            font-size: 13px;
        }
        
        .empty-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: #ddd;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="nav-bar">
        <div class="nav-back" onclick="goBack()">â†</div>
        <div id="pageTitle">é€‰æ‹©æœåŠ¡å¯¹è±¡</div>
        <div></div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content">
        <!-- åˆ—è¡¨é¡µé¢ -->
        <div id="listPage" class="list-page">
            <!-- ç­›é€‰åŒºåŸŸ -->
            <div class="filter-bar">
                <div class="filter-row">
                    <div class="filter-item">
                        <label class="filter-label">æ—¥æœŸ</label>
                        <input type="date" class="filter-input" id="filterDate" oninput="filterClues()">
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">å§“å</label>
                        <input type="text" class="filter-input" id="filterName" placeholder="è¯·è¾“å…¥" oninput="filterClues()">
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">è¡—é“/ä¹¡é•‡</label>
                        <select class="filter-select" id="filterStreet" onchange="onStreetChange()">
                            <option value="">å…¨éƒ¨</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">ç¤¾åŒº/æ‘å±¯</label>
                        <select class="filter-select" id="filterCommunity" onchange="onCommunityChange()">
                            <option value="">å…¨éƒ¨</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label class="filter-label">å°åŒº/è‡ªç„¶æ‘</label>
                        <select class="filter-select" id="filterCell" onchange="filterClues()">
                            <option value="">å…¨éƒ¨</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="filter-btn btn-reset" onclick="resetFilter()">é‡ç½®</button>
                </div>
            </div>

            <!-- çº¿ç´¢åˆ—è¡¨ -->
            <div class="clue-list">
                <div class="list-header">
                    <div class="col-date">æ—¥æœŸ</div>
                    <div class="col-name">å§“å</div>
                    <div class="col-family">å¤±èƒ½ç­‰çº§</div>
                    <div class="col-community">ç¤¾åŒº/æ‘é•‡</div>
                    <div class="col-address">è¯¦ç»†åœ°å€</div>
                    <div class="col-phone">è”ç³»ç”µè¯</div>
                    <div class="col-source">çº¿ç´¢æ¥æº</div>
                    <div class="col-action">æ“ä½œ</div>
                </div>
                <div id="clueListContainer">
                    <!-- åˆ—è¡¨æ•°æ®é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- è¡¨å•é¡µé¢ -->
        <div id="formPage" class="form-page">
            <!-- å·²é€‰æœåŠ¡å¯¹è±¡ä¿¡æ¯ï¼ˆåªè¯»æ˜¾ç¤ºï¼‰ -->
            <div class="form-section" id="selectedClueInfoSection" style="display: none;">
                <div class="section-title">å·²é€‰æœåŠ¡å¯¹è±¡ä¿¡æ¯</div>
                <div id="selectedClueInfo">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æœåŠ¡å¯¹è±¡ä¿¡æ¯ -->
            <div class="form-section">
            <div class="section-title">æœåŠ¡å¯¹è±¡ä¿¡æ¯</div>
            
            <div class="form-item">
                <div class="form-label required">å§“å</div>
                <div class="form-content">
                    <input type="text" class="form-input" id="clientName" placeholder="è¯·è¾“å…¥å§“å">
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label required">æ€§åˆ«</div>
                <div class="form-content">
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="clientGender" id="clientGenderMale" value="ç”·">
                            <label for="clientGenderMale">ç”·</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="clientGender" id="clientGenderFemale" value="å¥³">
                            <label for="clientGenderFemale">å¥³</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label required">èº«ä»½è¯å·</div>
                <div class="form-content">
                    <div class="id-card-scan">
                        <input type="text" class="form-input" id="clientIdCard" placeholder="è¯·è¾“å…¥æˆ–æ‰«æèº«ä»½è¯">
                        <button class="scan-btn" onclick="scanIdCard('client')">è¯†åˆ«</button>
                    </div>
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label">æˆ·ç±åœ°å€</div>
                <div class="form-content">
                    <input type="text" class="form-input" id="clientHukouAddress" placeholder="ä»èº«ä»½è¯è¯†åˆ«æˆ–æ‰‹åŠ¨è¾“å…¥">
                </div>
            </div>
            
            
            <div class="form-item">
                <div class="form-label required">è”ç³»ç”µè¯</div>
                <div class="form-content">
                    <input type="tel" class="form-input" id="clientPhone" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯">
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label required">åŒ»ä¿ç±»å‹</div>
                <div class="form-content">
                    <select class="form-select" id="medicalInsuranceType">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="åŸä¹¡å±…æ°‘åŒ»ä¿">åŸä¹¡å±…æ°‘åŒ»ä¿</option>
                        <option value="èŒå·¥åŒ»ä¿">èŒå·¥åŒ»ä¿</option>
                    </select>
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label">æ®‹ç–¾ç­‰çº§</div>
                <div class="form-content">
                    <select class="form-select" id="disabilityLevel">
                        <option value="">è¯·é€‰æ‹©</option>
                        <option value="ä¸€çº§">ä¸€çº§</option>
                        <option value="äºŒçº§">äºŒçº§</option>
                        <option value="ä¸‰çº§">ä¸‰çº§</option>
                    </select>
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label">æ˜¯å¦ä½ä¿æˆ·</div>
                <div class="form-content">
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="isLowIncome" id="isLowIncomeYes" value="æ˜¯">
                            <label for="isLowIncomeYes">æ˜¯</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="isLowIncome" id="isLowIncomeNo" value="å¦">
                            <label for="isLowIncomeNo">å¦</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label required">å¤±èƒ½åŸå› </div>
                <div class="form-content">
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="disabilityReason" id="reasonAging" value="å¹´è€">
                            <label for="reasonAging">å¹´è€</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="disabilityReason" id="reasonDisease" value="ç–¾ç—…">
                            <label for="reasonDisease">ç–¾ç—…</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="disabilityReason" id="reasonAccident" value="æ„å¤–">
                            <label for="reasonAccident">æ„å¤–</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="disabilityReason" id="reasonOther" value="å…¶ä»–">
                            <label for="reasonOther">å…¶ä»–</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label">æƒ…å†µè¯´æ˜</div>
                <div class="form-content">
                    <textarea class="form-textarea" id="clientDescription" placeholder="æ–‡å­—æè¿°æœåŠ¡å¯¹è±¡çš„å½“å‰çŠ¶æ€ï¼Œç”¨äºè¯„ä¼°é€šè¿‡åå¡«å†™æœåŠ¡è®¡åˆ’"></textarea>
                </div>
            </div>
        </div>

        <!-- å®¶å±ä¿¡æ¯ -->
        <div class="form-section">
            <div class="section-title">å®¶å±ä¿¡æ¯</div>
            
            <div class="form-item">
                <div class="form-label">å®¶å±å§“å</div>
                <div class="form-content">
                    <input type="text" class="form-input" id="familyName" placeholder="è¯·è¾“å…¥å®¶å±å§“å">
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label">å®¶å±èº«ä»½è¯å·</div>
                <div class="form-content">
                    <div class="id-card-scan">
                        <input type="text" class="form-input" id="familyIdCard" placeholder="è¯·è¾“å…¥æˆ–æ‰«æèº«ä»½è¯">
                        <button class="scan-btn" onclick="scanIdCard('family')">è¯†åˆ«</button>
                    </div>
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label">å®¶å±è”ç³»ç”µè¯</div>
                <div class="form-content">
                    <input type="tel" class="form-input" id="familyPhone" placeholder="è¯·è¾“å…¥å®¶å±è”ç³»ç”µè¯">
                </div>
            </div>
            
            <div class="form-item">
                <div class="form-label">å…³ç³»</div>
                <div class="form-content">
                    <select class="form-input" id="familyRelation">
                        <option value="">è¯·é€‰æ‹©å…³ç³»</option>
                        <option value="1">é…å¶</option>
                        <option value="2">å­å¥³</option>
                        <option value="3">äº²æˆš</option>
                        <option value="4">æœ‹å‹</option>
                        <option value="5">ç½‘æ ¼å‘˜</option>
                        <option value="6">å±…å§”ä¼š</option>
                        <option value="7">å…¶ä»–</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- åœ°ç†ä½ç½®ä¿¡æ¯ -->
        <div class="form-section">
            <div class="section-title">åœ°ç†ä½ç½®ä¿¡æ¯</div>
            
            <div class="location-section" id="locationSection">
                <div class="location-info" id="locationInfo">
                    <div class="location-item">
                        <strong>ç»çº¬åº¦ï¼š</strong>
                        <span id="locationCoordinates">è·å–ä¸­...</span>
                    </div>
                    <div class="location-item">
                        <strong>åœ°ç‚¹åç§°ï¼š</strong>
                        <span id="locationName">è·å–ä¸­...</span>
                    </div>
                </div>
                
                <div class="form-item" style="margin-bottom: 10px;">
                    <div class="form-label">åœ°æ ‡ç›¸å¯¹ä½ç½®</div>
                    <div class="form-content">
                        <input type="text" class="form-input" id="landmarkPosition" placeholder="å¦‚ï¼šè·ç¦»XXè¶…å¸‚50ç±³è·¯åŒ—">
                    </div>
                </div>
                
                <button class="location-confirm" id="confirmLocationBtn" onclick="confirmLocation()">ç¡®è®¤å®šä½ä¿¡æ¯</button>
                <div class="location-confirmed" id="locationConfirmed" style="display: none;">
                    âœ“ å®šä½ä¿¡æ¯å·²ç¡®è®¤ï¼Œä¸å¯ä¿®æ”¹
                </div>
            </div>
        </div>

        <!-- çº¸è´¨ææ–™ä¸Šä¼  -->
        <div class="form-section">
            <div class="section-title">çº¸è´¨ææ–™ä¸Šä¼ </div>
            <div class="upload-tips">æœ€å¤šä¸Šä¼ 10å¼ å›¾ç‰‡ï¼Œæ”¯æŒé¢„è§ˆå’Œåˆ é™¤é‡æ‹</div>
            
            <!-- åˆè¯„ææ–™ (position=1) -->
            <div class="archive-category">
                <div class="category-title">åˆè¯„ææ–™ (position=1)</div>
                <div class="category-tips">åŒ…æ‹¬ï¼šæœ¬äººèº«ä»½è¯ã€ä»£ç†äººèº«ä»½è¯ã€å¤±èƒ½ç­‰çº§è‡ªè¯„è¡¨ã€è¯„ä¼°ç”³è¯·è¡¨ã€ç—…æƒ…æ‰¿è¯ºä¹¦ã€ç—…ä¾‹æˆ–è¯æ˜ç­‰</div>
                <div class="upload-grid" id="archiveCategory1">
                    <!-- ä¸Šä¼ é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
        </div>
    </div>

    <!-- åº•éƒ¨æŒ‰é’®æ  - åˆ—è¡¨é¡µé¢ -->
    <div class="btn-bar" id="listBtnBar">
        <button class="btn btn-cancel" onclick="goBack()">è¿”å›</button>
    </div>
    
    <!-- åº•éƒ¨æŒ‰é’®æ  - è¡¨å•é¡µé¢ -->
    <div class="btn-bar" id="formBtnBar" style="display: none;">
        <button class="btn btn-cancel" onclick="goBack()">å–æ¶ˆ</button>
        <button class="btn btn-submit" id="submitBtn" onclick="submitForm()" disabled>æäº¤</button>
    </div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" class="file-input" id="fileInput" accept="image/*" capture="environment" multiple>

    <!-- æç¤ºæ¡† -->
    <div class="toast" id="toast">æ“ä½œæˆåŠŸ</div>

    <script>
        // å¾…ååŠ©ç”³è¯·çº¿ç´¢æ•°æ®ï¼ˆä¸è¯„ä¼°çº¿ç´¢æŸ¥è¯¢é¡µé¢ç›¸åŒï¼‰
        const originalClues = [
            { id: 1, date: '2025-06-15', name: 'å¼ ä¸‰', familyName: 'å¼ å°æ˜', community: 'å¹¸ç¦ç¤¾åŒº', address: '1æ ‹2å•å…ƒ301å®¤', 
              phone: '138XXXX1234', idCard: '34012319900101XXXX', source: 'ç¤¾åŒº', remark: '', level: 'é‡åº¦å¤±èƒ½ï¼ˆä¸‰çº§ï¼‰' },
            { id: 2, date: '2025-06-14', name: 'æå››', familyName: 'æäº”', community: 'è¥¿æ¹–åŒºXXç¤¾åŒº', address: 'è¥¿æ¹–åŒºXXè¡—é“XXå°åŒº3æ ‹502å®¤', 
              phone: '13812345678', idCard: '330101********1234', source: 'ç¤¾åŒº', remark: 'å¦‚:éœ€å‘¨æœ«ä¸Šé—¨ååŠ©ç”³è¯·', level: 'ä¸­åº¦å¤±èƒ½ï¼ˆäºŒçº§ï¼‰' },
            { id: 3, date: '2025-06-14', name: 'ç‹äº”', familyName: 'ç‹å¼º', community: 'å’Œè°å°åŒº', address: '3æ ‹5å•å…ƒ102å®¤', 
              phone: '135XXXX6789', idCard: '34012319780923XXXX', source: 'åŒ»é™¢', remark: '', level: 'è½»åº¦å¤±èƒ½ï¼ˆä¸€çº§ï¼‰' },
            { id: 4, date: '2025-06-13', name: 'èµµå…­', familyName: 'èµµæ•', community: 'é˜³å…‰æ‘', address: 'æ‘å§”ä¼šæ—', 
              phone: '133XXXX2345', idCard: '34012319820315XXXX', source: 'ç¤¾åŒº', remark: '', level: 'é‡åº¦å¤±èƒ½ï¼ˆä¸‰çº§ï¼‰' },
            { id: 5, date: '2025-06-12', name: 'å­™ä¸ƒ', familyName: 'å­™ä¼Ÿ', community: 'å¹¸ç¦ç¤¾åŒº', address: '2æ ‹1å•å…ƒ501å®¤', 
              phone: '131XXXX5678', idCard: '34012319950708XXXX', source: 'è¡—é“', remark: '', level: 'ä¸­åº¦å¤±èƒ½ï¼ˆäºŒçº§ï¼‰' }
        ];
        
        let currentClues = [...originalClues];
        let selectedClue = null; // å½“å‰é€‰ä¸­çš„æœåŠ¡å¯¹è±¡

        // ä¸‰çº§åœ°å€çº§è”æ•°æ®ï¼ˆè¡—é“/ä¹¡é•‡ -> ç¤¾åŒº/æ‘å±¯ -> å°åŒº/è‡ªç„¶æ‘ï¼‰
        const regionData = {
            'XXè¡—é“': {
                'å¹¸ç¦ç¤¾åŒº': ['XXå°åŒº', 'YYå°åŒº'],
                'XXç¤¾åŒº': ['XXå°åŒº', 'YYå°åŒº']
            },
            'YYè¡—é“': {
                'å¹³å®‰æ‘é•‡': ['AAæ‘', 'BBæ‘'],
                'å’Œè°å°åŒº': ['å’Œè°å°åŒº']
            },
            'XXé•‡': {
                'é˜³å…‰æ‘': ['ä¸œæ‘', 'è¥¿æ‘']
            }
        };

        // åˆå§‹åŒ–åœ°å€çº§è”é€‰æ‹©
        function initRegionCascade() {
            const streetSelect = document.getElementById('filterStreet');
            const communitySelect = document.getElementById('filterCommunity');
            const cellSelect = document.getElementById('filterCell');
            
            if (!streetSelect) return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
            
            // åˆå§‹åŒ–è¡—é“/ä¹¡é•‡é€‰é¡¹
            Object.keys(regionData).forEach(street => {
                const option = document.createElement('option');
                option.value = street;
                option.textContent = street;
                streetSelect.appendChild(option);
            });
        }

        // è¡—é“/ä¹¡é•‡å˜åŒ–æ—¶æ›´æ–°ç¤¾åŒº/æ‘å±¯é€‰é¡¹
        function onStreetChange() {
            const street = document.getElementById('filterStreet').value;
            const communitySelect = document.getElementById('filterCommunity');
            const cellSelect = document.getElementById('filterCell');
            
            // æ¸…ç©ºå¹¶é‡ç½®ç¤¾åŒº/æ‘å±¯å’Œå°åŒº/è‡ªç„¶æ‘
            communitySelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
            cellSelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
            
            if (street && regionData[street]) {
                Object.keys(regionData[street]).forEach(community => {
                    const option = document.createElement('option');
                    option.value = community;
                    option.textContent = community;
                    communitySelect.appendChild(option);
                });
            }
            
            filterClues();
        }

        // ç¤¾åŒº/æ‘å±¯å˜åŒ–æ—¶æ›´æ–°å°åŒº/è‡ªç„¶æ‘é€‰é¡¹
        function onCommunityChange() {
            const street = document.getElementById('filterStreet').value;
            const community = document.getElementById('filterCommunity').value;
            const cellSelect = document.getElementById('filterCell');
            
            // æ¸…ç©ºå¹¶é‡ç½®å°åŒº/è‡ªç„¶æ‘
            cellSelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
            
            if (street && community && regionData[street] && regionData[street][community]) {
                regionData[street][community].forEach(cell => {
                    const option = document.createElement('option');
                    option.value = cell;
                    option.textContent = cell;
                    cellSelect.appendChild(option);
                });
            }
            
            filterClues();
        }
        
        // æ¡£æ¡ˆææ–™ç»“æ„ï¼ˆæ ¹æ®æ•°æ®åº“ï¼‰
        const archiveStructure = {
            1: [ // åˆè¯„ææ–™
                { id: 1, name: 'æœ¬äººèº«ä»½è¯', pageNum: 2, optional: false, yangNeed: false },
                { id: 2, name: 'ä»£ç†äººèº«ä»½è¯', pageNum: 2, optional: true, yangNeed: false },
                { id: 4, name: 'å¤±èƒ½ç­‰çº§è‡ªè¯„è¡¨', pageNum: 1, optional: false, yangNeed: false },
                { id: 5, name: 'è¯„ä¼°ç”³è¯·è¡¨', pageNum: 2, optional: false, yangNeed: false },
                { id: 6, name: 'ç—…æƒ…æ‰¿è¯ºä¹¦', pageNum: 1, optional: false, yangNeed: false },
                { id: 7, name: 'ç—…ä¾‹æˆ–è¯æ˜', pageNum: 0, optional: false, yangNeed: true }
            ],
        };
        
        // ä¸Šä¼ çš„æ–‡ä»¶æ•°æ®
        let uploadedFiles = {
            1: {}, // position=1çš„æ–‡ä»¶
        };
        
        let totalFileCount = 0;
        let locationConfirmed = false;
        let currentUploadCategory = null;
        let currentUploadFileId = null;
        
        // åœ°ç†ä½ç½®æ•°æ®
        let locationData = {
            longitude: null,
            latitude: null,
            name: '',
            landmark: ''
        };
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ–åœ°å€çº§è”é€‰æ‹©
            initRegionCascade();
            
            // æ£€æŸ¥URLå‚æ•°ï¼Œå¦‚æœæœ‰clueIdåˆ™ç›´æ¥è¿›å…¥è¡¨å•é¡µé¢
            const urlParams = new URLSearchParams(window.location.search);
            const clueId = urlParams.get('clueId');
            
            if (clueId) {
                const clue = originalClues.find(c => c.id == clueId);
                if (clue) {
                    selectClue(clue);
                } else {
                    showListPage();
                }
            } else {
                showListPage();
            }
        };
        
        // æ˜¾ç¤ºåˆ—è¡¨é¡µé¢
        function showListPage() {
            document.getElementById('listPage').classList.remove('hidden');
            document.getElementById('formPage').classList.remove('show');
            document.getElementById('listBtnBar').style.display = 'flex';
            document.getElementById('formBtnBar').style.display = 'none';
            document.getElementById('pageTitle').textContent = 'é€‰æ‹©æœåŠ¡å¯¹è±¡';
            renderClueList();
        }
        
        // æ˜¾ç¤ºè¡¨å•é¡µé¢
        function showFormPage() {
            document.getElementById('listPage').classList.add('hidden');
            document.getElementById('formPage').classList.add('show');
            document.getElementById('listBtnBar').style.display = 'none';
            document.getElementById('formBtnBar').style.display = 'flex';
            document.getElementById('pageTitle').textContent = 'ç°åœºååŠ©ç”³è¯·ç™»è®°';
            initArchiveUpload();
            getLocation();
        }
        
        // æ¸²æŸ“çº¿ç´¢åˆ—è¡¨
        function renderClueList() {
            const container = document.getElementById('clueListContainer');
            container.innerHTML = '';
            
            if (currentClues.length === 0) {
                container.innerHTML = `
                    <div class="empty-data">
                        <div class="empty-icon">ğŸ“„</div>
                        <div>æš‚æ— ç¬¦åˆæ¡ä»¶çš„çº¿ç´¢</div>
                    </div>
                `;
                return;
            }
            
            currentClues.forEach(clue => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="col-date">${clue.date}</div>
                    <div class="col-name">${clue.name}</div>
                    <div class="col-family">${clue.level || '-'}</div>
                    <div class="col-community">${clue.community}</div>
                    <div class="col-address">${clue.address}</div>
                    <div class="col-phone" style="display: flex; align-items: center; gap: 4px;">
                        <span>${clue.phone || '-'}</span>
                        ${clue.phone ? `<a href="tel:${clue.phone.replace(/\s/g, '').replace(/X/g, '0')}" style="color: var(--primary-color); text-decoration: none; font-size: 12px;">ğŸ“</a>` : ''}
                    </div>
                    <div class="col-source">${clue.source || '-'}</div>
                    <div class="col-action">
                        <button class="select-btn" onclick="selectClueById(${clue.id})">é€‰æ‹©</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // ç­›é€‰çº¿ç´¢
        function filterClues() {
            const date = document.getElementById('filterDate').value;
            const name = document.getElementById('filterName').value.toLowerCase();
            const street = document.getElementById('filterStreet').value;
            const community = document.getElementById('filterCommunity').value;
            const cell = document.getElementById('filterCell').value;
            
            currentClues = originalClues.filter(clue => {
                let match = true;
                
                if (date && clue.date !== date) match = false;
                if (name && !clue.name.toLowerCase().includes(name)) match = false;
                
                // ä¸‰çº§åœ°å€ç­›é€‰ï¼šå¦‚æœé€‰æ‹©äº†è¡—é“ï¼Œåˆ™å¿…é¡»åŒ¹é…è¡—é“ï¼›å¦‚æœé€‰æ‹©äº†ç¤¾åŒºï¼Œåˆ™å¿…é¡»åŒ¹é…ç¤¾åŒºï¼›å¦‚æœé€‰æ‹©äº†å°åŒºï¼Œåˆ™å¿…é¡»åŒ¹é…å°åŒº
                // æ”¯æŒåªé€‰æ‹©å‰ä¸€çº§æˆ–å‰äºŒçº§
                if (street) {
                    // æ£€æŸ¥çº¿ç´¢çš„åœ°å€æ˜¯å¦åŒ…å«è¯¥è¡—é“
                    const addressMatch = clue.address.includes(street) || clue.community.includes(street);
                    if (!addressMatch) {
                        // å¦‚æœè¿˜é€‰æ‹©äº†ç¤¾åŒºï¼Œéœ€è¦æ›´ç²¾ç¡®åŒ¹é…
                        if (community) {
                            if (!clue.community.includes(community)) match = false;
                        } else {
                            match = false;
                        }
                    } else if (community) {
                        if (!clue.community.includes(community)) match = false;
                        if (cell && !clue.address.includes(cell)) match = false;
                    } else if (cell) {
                        if (!clue.address.includes(cell)) match = false;
                    }
                } else if (community) {
                    if (!clue.community.includes(community)) match = false;
                    if (cell && !clue.address.includes(cell)) match = false;
                } else if (cell) {
                    if (!clue.address.includes(cell)) match = false;
                }
                
                return match;
            });
            
            renderClueList();
        }
        
        // é‡ç½®ç­›é€‰æ¡ä»¶
        function resetFilter() {
            document.getElementById('filterDate').value = '';
            document.getElementById('filterName').value = '';
            document.getElementById('filterStreet').value = '';
            document.getElementById('filterCommunity').value = '';
            document.getElementById('filterCell').value = '';
            
            // é‡ç½®çº§è”é€‰æ‹©
            document.getElementById('filterCommunity').innerHTML = '<option value="">å…¨éƒ¨</option>';
            document.getElementById('filterCell').innerHTML = '<option value="">å…¨éƒ¨</option>';
            
            currentClues = [...originalClues];
            renderClueList();
        }
        
        // æ ¹æ®IDé€‰æ‹©çº¿ç´¢
        function selectClueById(clueId) {
            const clue = originalClues.find(c => c.id === clueId);
            if (clue) {
                selectClue(clue);
            }
        }
        
        // é€‰æ‹©æœåŠ¡å¯¹è±¡å¹¶è·³è½¬åˆ°è¡¨å•é¡µé¢
        function selectClue(clue) {
            selectedClue = clue;
            
            // é¢„å¡«å……è¡¨å•æ•°æ®
            document.getElementById('clientName').value = clue.name || '';
            document.getElementById('clientIdCard').value = clue.idCard || '';
            document.getElementById('clientPhone').value = clue.phone || '';
            document.getElementById('clientHukouAddress').value = clue.community + clue.address || '';
            
            // å¡«å……å®¶å±ä¿¡æ¯
            document.getElementById('familyName').value = clue.familyName || '';
            document.getElementById('familyPhone').value = clue.phone || ''; // å¦‚æœæœ‰å®¶å±ç”µè¯å­—æ®µ
            
            // æ˜¾ç¤ºè¡¨å•é¡µé¢
            showFormPage();
            
            // æ›´æ–°æœåŠ¡å¯¹è±¡ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ
            updateServiceObjectInfo(clue);
            
            // æ˜¾ç¤ºå·²é€‰æœåŠ¡å¯¹è±¡ä¿¡æ¯åŒºåŸŸ
            document.getElementById('selectedClueInfoSection').style.display = 'block';
            
            // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
            updateSubmitButton();
        }
        
        // æ›´æ–°æœåŠ¡å¯¹è±¡ä¿¡æ¯æ˜¾ç¤º
        function updateServiceObjectInfo(clue) {
            // å¦‚æœé¡µé¢ä¸Šæœ‰æ˜¾ç¤ºæœåŠ¡å¯¹è±¡ä¿¡æ¯çš„åŒºåŸŸï¼Œæ›´æ–°å®ƒ
            const infoSection = document.getElementById('selectedClueInfo');
            if (infoSection) {
                const fullAddress = `${clue.community}${clue.address}`;
                infoSection.innerHTML = `
                    <div class="form-item">
                        <div class="form-label">å¤±èƒ½ç­‰çº§</div>
                        <div class="form-content">${clue.level || 'æœªè¯„ä¼°'}</div>
                    </div>
                    <div class="form-item">
                        <div class="form-label">è”ç³»ç”µè¯</div>
                        <div class="form-content" style="display: flex; align-items: center; gap: 8px;">
                            <span>${clue.phone || 'æœªå¡«å†™'}</span>
                            ${clue.phone ? `<a href="tel:${clue.phone.replace(/\s/g, '').replace(/X/g, '0')}" style="color: var(--primary-color); text-decoration: none; font-size: 16px;">ğŸ“</a>` : ''}
                        </div>
                    </div>
                    <div class="form-item">
                        <div class="form-label">æœåŠ¡åœ°å€</div>
                        <div class="form-content" style="display: flex; align-items: center; justify-content: space-between;">
                            <span>${fullAddress || 'æœªå¡«å†™'}</span>
                            ${fullAddress ? `<button onclick="openRegistrationNavigation('${fullAddress}')" style="padding: 4px 12px; background: var(--primary-color); color: #fff; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">å¯¼èˆª</button>` : ''}
                        </div>
                    </div>
                `;
            }
        }
        
        // æ‰“å¼€ç™»è®°åŠŸèƒ½å¯¼èˆª
        function openRegistrationNavigation(address) {
            if (!address) {
                showToast('åœ°å€ä¿¡æ¯ä¸å®Œæ•´');
                return;
            }
            
            const amapUrl = `https://uri.amap.com/navigation?to=${encodeURIComponent(address)}&mode=car&policy=1&src=mypage&coordinate=gaode&callnative=1`;
            const amapLink = document.createElement('a');
            amapLink.href = amapUrl;
            amapLink.target = '_blank';
            amapLink.click();
            
            setTimeout(() => {
                const baiduUrl = `https://api.map.baidu.com/direction?destination=${encodeURIComponent(address)}&mode=driving&region=å…¨å›½&output=html&src=webapp`;
                window.open(baiduUrl, '_blank');
            }, 500);
            
            showToast(`æ­£åœ¨æ‰“å¼€åœ°å›¾å¯¼èˆª...`);
        }
        
        // åˆå§‹åŒ–æ¡£æ¡ˆä¸Šä¼ åŒºåŸŸ
        function initArchiveUpload() {
            // åªåˆå§‹åŒ–åˆè¯„ææ–™ï¼ˆposition=1ï¼‰
            const container = document.getElementById('archiveCategory1');
            if (container) {
                container.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
                const files = archiveStructure[1];
                
                files.forEach(file => {
                    const uploadItem = createUploadItem(file, 1);
                    container.appendChild(uploadItem);
                });
            }
        }
        
        // åˆ›å»ºä¸Šä¼ é¡¹
        function createUploadItem(file, position) {
            const item = document.createElement('div');
            item.className = 'upload-item';
            item.dataset.fileId = file.id;
            item.dataset.position = position;
            
            // æ£€æŸ¥æ˜¯å¦å·²æœ‰ä¸Šä¼ çš„æ–‡ä»¶
            const uploadedFile = uploadedFiles[position][file.id];
            
            // åˆ›å»ºæ ‡é¢˜
            const header = document.createElement('div');
            header.className = 'upload-item-header';
            let headerText = file.name;
            if (file.pageNum > 0) {
                headerText += ` (${file.pageNum}é¡µ)`;
            }
            header.textContent = headerText;
            
            // åˆ›å»ºå†…å®¹åŒºåŸŸ
            const body = document.createElement('div');
            body.className = 'upload-item-body';
            
            if (uploadedFile) {
                // æ˜¾ç¤ºå·²ä¸Šä¼ çš„å›¾ç‰‡
                item.classList.add('uploaded');
                const img = document.createElement('img');
                img.src = uploadedFile.url;
                img.alt = file.name;
                body.appendChild(img);
                
                const deleteBtn = document.createElement('div');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Ã—';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteFile(position, file.id);
                };
                body.appendChild(deleteBtn);
                
                const status = document.createElement('div');
                status.className = 'file-status';
                status.textContent = 'å·²ä¸Šä¼ ';
                body.appendChild(status);
                
                item.onclick = () => previewFile(uploadedFile.url, file.name);
            } else {
                // æ˜¾ç¤ºæ·»åŠ æŒ‰é’®
                item.classList.add('add-btn');
                item.onclick = () => openFilePicker(position, file.id, file.name);
            }
            
            // æ·»åŠ æ ‡ç­¾
            if (file.optional) {
                const optionalTag = document.createElement('div');
                optionalTag.className = 'optional-tag';
                optionalTag.textContent = 'å¯é€‰';
                body.appendChild(optionalTag);
            }
            
            if (file.yangNeed) {
                const yangTag = document.createElement('div');
                yangTag.className = 'yang-need-tag';
                yangTag.textContent = '60å²ä»¥ä¸‹';
                body.appendChild(yangTag);
            }
            
            item.appendChild(header);
            item.appendChild(body);
            
            return item;
        }
        
        // æ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨
        function openFilePicker(position, fileId, fileName) {
            if (totalFileCount >= 10) {
                showToast('æœ€å¤šåªèƒ½ä¸Šä¼ 10å¼ å›¾ç‰‡');
                return;
            }
            
            currentUploadCategory = position;
            currentUploadFileId = fileId;
            
            const fileInput = document.getElementById('fileInput');
            fileInput.onchange = function(e) {
                handleFileSelect(e, position, fileId, fileName);
            };
            fileInput.click();
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(event, position, fileId, fileName) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                return;
            }
            
            // ç”Ÿæˆæ–‡ä»¶åï¼šæ—¥æœŸ+æœåŠ¡å¯¹è±¡å§“å+ææ–™ç±»å‹
            const clientName = document.getElementById('clientName').value || 'æœåŠ¡å¯¹è±¡';
            const date = new Date().toISOString().split('T')[0].replace(/-/g, '');
            const fileExtension = file.name.split('.').pop();
            const generatedFileName = `${date}${clientName}${fileName}.${fileExtension}`;
            
            // åˆ›å»ºé¢„è§ˆURL
            const reader = new FileReader();
            reader.onload = function(e) {
                const fileData = {
                    file: file,
                    url: e.target.result,
                    fileName: generatedFileName,
                    fileId: fileId,
                    position: position
                };
                
                // ä¿å­˜æ–‡ä»¶æ•°æ®
                uploadedFiles[position][fileId] = fileData;
                totalFileCount++;
                
                // æ›´æ–°ä¸Šä¼ é¡¹æ˜¾ç¤º
                updateUploadItem(position, fileId, fileData);
                
                // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
                updateSubmitButton();
            };
            reader.readAsDataURL(file);
        }
        
        // æ›´æ–°ä¸Šä¼ é¡¹
        function updateUploadItem(position, fileId, fileData) {
            const container = document.getElementById(`archiveCategory${position}`);
            const item = container.querySelector(`[data-file-id="${fileId}"]`);
            
            if (item) {
                const file = archiveStructure[position].find(f => f.id === fileId);
                item.className = 'upload-item uploaded';
                
                // ä¿ç•™æ ‡é¢˜
                const header = item.querySelector('.upload-item-header');
                
                // æ›´æ–°å†…å®¹åŒºåŸŸ
                const body = item.querySelector('.upload-item-body');
                body.innerHTML = '';
                
                const img = document.createElement('img');
                img.src = fileData.url;
                img.alt = file.name;
                body.appendChild(img);
                
                const deleteBtn = document.createElement('div');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Ã—';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteFile(position, fileId);
                };
                body.appendChild(deleteBtn);
                
                const status = document.createElement('div');
                status.className = 'file-status';
                status.textContent = 'å·²ä¸Šä¼ ';
                body.appendChild(status);
                
                // é‡æ–°æ·»åŠ æ ‡ç­¾
                if (file.optional) {
                    const optionalTag = document.createElement('div');
                    optionalTag.className = 'optional-tag';
                    optionalTag.textContent = 'å¯é€‰';
                    body.appendChild(optionalTag);
                }
                
                if (file.yangNeed) {
                    const yangTag = document.createElement('div');
                    yangTag.className = 'yang-need-tag';
                    yangTag.textContent = '60å²ä»¥ä¸‹';
                    body.appendChild(yangTag);
                }
                
                item.onclick = () => previewFile(fileData.url, file.name);
            }
        }
        
        // åˆ é™¤æ–‡ä»¶
        function deleteFile(position, fileId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ')) {
                delete uploadedFiles[position][fileId];
                totalFileCount--;
                
                // é‡æ–°åˆ›å»ºä¸Šä¼ é¡¹
                const container = document.getElementById(`archiveCategory${position}`);
                const item = container.querySelector(`[data-file-id="${fileId}"]`);
                const file = archiveStructure[position].find(f => f.id === fileId);
                
                item.className = 'upload-item add-btn';
                
                // ä¿ç•™æ ‡é¢˜
                const header = item.querySelector('.upload-item-header');
                
                // é‡ç½®å†…å®¹åŒºåŸŸ
                const body = item.querySelector('.upload-item-body');
                body.innerHTML = '';
                
                item.onclick = () => openFilePicker(position, fileId, file.name);
                
                updateSubmitButton();
            }
        }
        
        // é¢„è§ˆæ–‡ä»¶
        function previewFile(url, fileName) {
            // å®é™…é¡¹ç›®ä¸­å¯ä»¥æ‰“å¼€å…¨å±é¢„è§ˆ
            showToast(`é¢„è§ˆï¼š${fileName}`);
        }
        
        // è·å–åœ°ç†ä½ç½®
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        locationData.latitude = position.coords.latitude;
                        locationData.longitude = position.coords.longitude;
                        
                        document.getElementById('locationCoordinates').textContent = 
                            `${locationData.latitude.toFixed(6)}, ${locationData.longitude.toFixed(6)}`;
                        
                        // åå‘åœ°ç†ç¼–ç è·å–åœ°ç‚¹åç§°ï¼ˆå®é™…é¡¹ç›®ä¸­è°ƒç”¨åœ°å›¾APIï¼‰
                        reverseGeocode(locationData.latitude, locationData.longitude);
                    },
                    function(error) {
                        document.getElementById('locationCoordinates').textContent = 'è·å–å¤±è´¥';
                        document.getElementById('locationName').textContent = 'è¯·æ‰‹åŠ¨è¾“å…¥';
                        showToast('æ— æ³•è·å–GPSä½ç½®ï¼Œè¯·æ£€æŸ¥å®šä½æƒé™');
                    }
                );
            } else {
                document.getElementById('locationCoordinates').textContent = 'ä¸æ”¯æŒå®šä½';
                document.getElementById('locationName').textContent = 'è¯·æ‰‹åŠ¨è¾“å…¥';
            }
        }
        
        // åå‘åœ°ç†ç¼–ç ï¼ˆæ¨¡æ‹Ÿï¼‰
        function reverseGeocode(lat, lng) {
            // å®é™…é¡¹ç›®ä¸­è°ƒç”¨åœ°å›¾APIè·å–åœ°ç‚¹åç§°
            // è¿™é‡Œæ¨¡æ‹Ÿè¿”å›
            setTimeout(() => {
                locationData.name = 'XXæ‘æ‘å§”ä¼šæ—';
                document.getElementById('locationName').textContent = locationData.name;
            }, 500);
        }
        
        // ç¡®è®¤å®šä½ä¿¡æ¯
        function confirmLocation() {
            if (!locationData.latitude || !locationData.longitude) {
                showToast('è¯·å…ˆè·å–GPSä½ç½®');
                return;
            }
            
            locationData.landmark = document.getElementById('landmarkPosition').value;
            locationConfirmed = true;
            
            // ç¦ç”¨å®šä½ç›¸å…³è¾“å…¥
            document.getElementById('landmarkPosition').readOnly = true;
            document.getElementById('confirmLocationBtn').disabled = true;
            document.getElementById('locationConfirmed').style.display = 'block';
            
            updateSubmitButton();
            showToast('å®šä½ä¿¡æ¯å·²ç¡®è®¤');
        }
        
        // èº«ä»½è¯è¯†åˆ«ï¼ˆæ¨¡æ‹Ÿï¼‰
        function scanIdCard(type) {
            showToast('æ­£åœ¨æ‰“å¼€ç›¸æœºè¯†åˆ«èº«ä»½è¯...');
            
            // å®é™…é¡¹ç›®ä¸­è°ƒç”¨ç›¸æœºAPIè¯†åˆ«èº«ä»½è¯
            setTimeout(() => {
                if (type === 'client') {
                    // æ¨¡æ‹Ÿè¯†åˆ«ç»“æœ
                    document.getElementById('clientIdCard').value = '330101199001011234';
                    document.getElementById('clientHukouAddress').value = 'æµ™æ±Ÿçœæ­å·å¸‚è¥¿æ¹–åŒºXXè¡—é“XXç¤¾åŒº';
                    showToast('èº«ä»½è¯è¯†åˆ«æˆåŠŸ');
                } else {
                    document.getElementById('familyIdCard').value = '330101198001011234';
                    showToast('èº«ä»½è¯è¯†åˆ«æˆåŠŸ');
                }
            }, 1500);
        }
        
        // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
        function updateSubmitButton() {
            const clientName = document.getElementById('clientName').value;
            const clientGender = document.querySelector('input[name="clientGender"]:checked');
            const clientIdCard = document.getElementById('clientIdCard').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const medicalInsurance = document.getElementById('medicalInsuranceType').value;
            const disabilityReason = document.querySelector('input[name="disabilityReason"]:checked');
            
            const canSubmit = clientName && 
                             clientGender && 
                             clientIdCard && 
                             clientPhone && 
                             medicalInsurance && 
                             disabilityReason && 
                             locationConfirmed;
            
            document.getElementById('submitBtn').disabled = !canSubmit;
        }
        
        // ç›‘å¬è¡¨å•å˜åŒ–
        document.addEventListener('input', function(e) {
            if (e.target.matches('.form-input, .form-select, .form-textarea')) {
                updateSubmitButton();
            }
        });
        
        document.addEventListener('change', function(e) {
            if (e.target.matches('input[type="radio"]')) {
                updateSubmitButton();
            }
        });
        
        // æäº¤è¡¨å•
        function submitForm() {
            // æ”¶é›†è¡¨å•æ•°æ®
            const formData = {
                // æœåŠ¡å¯¹è±¡ä¿¡æ¯
                client: {
                    name: document.getElementById('clientName').value,
                    gender: document.querySelector('input[name="clientGender"]:checked')?.value,
                    idCard: document.getElementById('clientIdCard').value,
                    hukouAddress: document.getElementById('clientHukouAddress').value,
                    residenceAddress: document.getElementById('clientResidenceAddress').value,
                    phone: document.getElementById('clientPhone').value,
                    medicalInsuranceType: document.getElementById('medicalInsuranceType').value,
                    disabilityLevel: document.getElementById('disabilityLevel').value,
                    isLowIncome: document.querySelector('input[name="isLowIncome"]:checked')?.value,
                    disabilityReason: document.querySelector('input[name="disabilityReason"]:checked')?.value,
                    description: document.getElementById('clientDescription').value
                },
                // å®¶å±ä¿¡æ¯
                family: {
                    name: document.getElementById('familyName').value,
                    idCard: document.getElementById('familyIdCard').value,
                    phone: document.getElementById('familyPhone').value,
                    relation: document.getElementById('familyRelation').value
                },
                // åœ°ç†ä½ç½®
                location: locationData,
                // ä¸Šä¼ çš„æ–‡ä»¶
                files: uploadedFiles
            };
            
            // éªŒè¯å¿…å¡«é¡¹
            if (!formData.client.name) {
                showToast('è¯·å¡«å†™æœåŠ¡å¯¹è±¡å§“å');
                return;
            }
            if (!formData.client.gender) {
                showToast('è¯·é€‰æ‹©æœåŠ¡å¯¹è±¡æ€§åˆ«');
                return;
            }
            if (!formData.client.idCard) {
                showToast('è¯·å¡«å†™æœåŠ¡å¯¹è±¡èº«ä»½è¯å·');
                return;
            }
            if (!formData.client.phone) {
                showToast('è¯·å¡«å†™æœåŠ¡å¯¹è±¡è”ç³»ç”µè¯');
                return;
            }
            if (!formData.client.medicalInsuranceType) {
                showToast('è¯·é€‰æ‹©åŒ»ä¿ç±»å‹');
                return;
            }
            if (!formData.client.disabilityReason) {
                showToast('è¯·é€‰æ‹©å¤±èƒ½åŸå› ');
                return;
            }
            if (!locationConfirmed) {
                showToast('è¯·ç¡®è®¤å®šä½ä¿¡æ¯');
                return;
            }
            
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œæäº¤åˆ°æœåŠ¡å™¨
            console.log('æäº¤è¡¨å•æ•°æ®:', formData);
            showToast('æäº¤æˆåŠŸï¼Œæ•°æ®å·²åŒæ­¥è‡³å¹³å°');
            
            // å»¶è¿Ÿè¿”å›åˆ—è¡¨é¡µé¢
            setTimeout(() => {
                showListPage();
                resetForm();
            }, 1500);
        }
        
        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            // å¦‚æœåœ¨è¡¨å•é¡µé¢ï¼Œè¿”å›åˆ—è¡¨é¡µé¢
            if (document.getElementById('formPage').classList.contains('show')) {
                if (confirm('ç¡®å®šè¦è¿”å›å—ï¼Ÿæœªä¿å­˜çš„æ•°æ®å°†ä¸¢å¤±ã€‚')) {
                    showListPage();
                    // é‡ç½®è¡¨å•
                    resetForm();
                }
            } else {
                // å¦‚æœåœ¨åˆ—è¡¨é¡µé¢ï¼Œè¿”å›é¦–é¡µ
                window.location.href = 'index.html';
            }
        }
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            selectedClue = null;
            locationConfirmed = false;
            uploadedFiles = { 1: {} };
            totalFileCount = 0;
            locationData = {
                longitude: null,
                latitude: null,
                name: '',
                landmark: ''
            };
            
            // æ¸…ç©ºæ‰€æœ‰è¡¨å•å­—æ®µ
            document.getElementById('clientName').value = '';
            document.getElementById('clientIdCard').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientHukouAddress').value = '';
            document.querySelector('input[name="clientGender"]:checked')?.removeAttribute('checked');
            document.getElementById('medicalInsuranceType').value = '';
            document.getElementById('disabilityLevel').value = '';
            document.querySelector('input[name="isLowIncome"]:checked')?.removeAttribute('checked');
            document.querySelector('input[name="disabilityReason"]:checked')?.removeAttribute('checked');
            document.getElementById('clientDescription').value = '';
            document.getElementById('familyName').value = '';
            document.getElementById('familyIdCard').value = '';
            document.getElementById('familyPhone').value = '';
            document.getElementById('familyRelation').value = '';
            document.getElementById('landmarkPosition').value = '';
            document.getElementById('landmarkPosition').readOnly = false;
            document.getElementById('confirmLocationBtn').disabled = false;
            document.getElementById('locationConfirmed').style.display = 'none';
            
            // é‡æ–°è·å–å®šä½
            getLocation();
        }
        
        // æ˜¾ç¤ºæç¤ºæ¡†
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }
    </script>
</body>
</html>
