<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å±…å®¶é•¿æŠ¤ååŠ©ç”³è¯·ç³»ç»Ÿ - ååŠ©ç”³è¯·çº¿ç´¢æŸ¥çœ‹</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        
        :root {
            --primary-color: #2f80ed;
            --success-color: #52c41a;
            --warning-color: #faad14;
            --danger-color: #ff4d4f;
            --text-color: #333;
            --text-secondary: #666;
            --text-tertiary: #999;
            --border-color: #ddd;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        body {
            background-color: #f5f7fa;
            font-size: 14px;
            color: var(--text-color);
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .nav-bar {
            height: 44px;
            line-height: 44px;
            background-color: var(--primary-color);
            color: #fff;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 999;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
        }
        
        .nav-back {
            font-size: 18px;
            cursor: pointer;
        }
        
        .nav-right {
            font-size: 14px;
            color: #fff;
            cursor: pointer;
        }
        
        /* å†…å®¹å®¹å™¨ */
        .content {
            padding: 54px 15px 15px;
        }
        
        /* ç­›é€‰åŒºåŸŸ */
        .filter-bar {
            background-color: #fff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: var(--card-shadow);
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .filter-item {
            flex: 1;
            min-width: 120px;
        }
        
        .filter-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            display: block;
        }
        
        .filter-input, .filter-select {
            width: 100%;
            height: 34px;
            padding: 0 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 13px;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            border: none;
        }
        
        .btn-reset {
            background-color: #f5f5f5;
            color: var(--text-secondary);
        }
        
        /* çº¿ç´¢åˆ—è¡¨ */
        .clue-list {
            background-color: #fff;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: var(--card-shadow);
        }
        
        .list-header {
            display: flex;
            padding: 10px 12px;
            border-bottom: 1px solid #f5f5f5;
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 500;
        }
        
        .list-item {
            display: flex;
            padding: 12px;
            border-bottom: 1px solid #f5f5f5;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .list-item:hover {
            background-color: #f9f9f9;
        }
        
        .list-item:active {
            background-color: #f0f0f0;
        }
        
        .col-date {
            width: 10%;
            flex-shrink: 0;
        }
        
        .col-name {
            width: 8%;
            flex-shrink: 0;
        }
        
        .col-family {
            width: 8%;
            flex-shrink: 0;
        }
        
        .col-community {
            width: 12%;
            flex-shrink: 0;
        }
        
        .col-address {
            width: 20%;
            flex-shrink: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .col-phone {
            width: 12%;
            flex-shrink: 0;
        }
        
        .col-source {
            width: 10%;
            flex-shrink: 0;
        }
        
        .col-action {
            width: 20%;
            flex-shrink: 0;
            text-align: center;
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .view-btn, .nav-btn {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            flex: 1;
            max-width: 60px;
        }
        
        .view-btn {
            background-color: #e8f4ff;
            color: var(--primary-color);
        }
        
        .nav-btn {
            background-color: #f0fff4;
            color: var(--success-color);
        }
        
        /* è¯¦æƒ…å¼¹çª— */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: #fff;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: all 0.3s;
        }
        
        .modal.show .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 16px;
            font-weight: 500;
        }
        
        .modal-close {
            font-size: 20px;
            color: var(--text-tertiary);
            cursor: pointer;
        }
        
        .modal-body {
            padding: 15px;
        }
        
        .modal-footer {
            padding: 12px 15px;
            border-top: 1px solid #f5f5f5;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            border: none;
        }
        
        .btn-cancel {
            background-color: #f5f5f5;
            color: var(--text-secondary);
        }
        
        .btn-confirm {
            background-color: var(--primary-color);
            color: #fff;
        }
        
        /* è¯¦æƒ…é¡µæ ·å¼ */
        .detail-section {
            margin-bottom: 15px;
        }
        
        .detail-section-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 10px;
            color: var(--text-color);
            padding-bottom: 5px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .detail-form-item {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        
        .detail-label {
            width: 80px;
            flex-shrink: 0;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .detail-value {
            flex: 1;
            font-size: 13px;
            color: var(--text-color);
        }
        
        .detail-input {
            width: 100%;
            height: 34px;
            padding: 0 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 13px;
        }
        
        .detail-textarea {
            width: 100%;
            min-height: 80px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 13px;
            resize: vertical;
            font-family: inherit;
        }
        
        .edit-tag {
            font-size: 11px;
            color: var(--primary-color);
            margin-left: 5px;
            cursor: pointer;
        }
        
        .readonly-tag {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-left: 5px;
        }
        
        /* ä¸¤åˆ—å¸ƒå±€ */
        .detail-form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-form-col {
            flex: 1;
        }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼ */
        @media (max-width: 600px) {
            .detail-form-row {
                flex-direction: column;
                gap: 0;
            }
        }
        
        /* æ–°å»ºçº¿ç´¢å¼¹çª— */
        .tabs {
            display: flex;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .tab-item {
            flex: 1;
            text-align: center;
            padding: 12px;
            font-size: 14px;
            color: var(--text-tertiary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab-item.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .tab-content {
            padding: 15px 0;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }
        
        /* æ‹ç…§è¯†åˆ«å›¾æ ‡ */
        .scan-icon {
            width: 20px;
            height: 20px;
            margin-left: 5px;
            color: var(--primary-color);
            cursor: pointer;
        }
        
        /* ç¡®è®¤å¼¹çª— */
        .confirm-modal .modal-content {
            width: 80%;
            max-width: 300px;
        }
        
        /* åŠ è½½æç¤º */
        .loading {
            padding: 20px;
            text-align: center;
            color: var(--text-tertiary);
            font-size: 13px;
        }
        
        /* ç©ºæ•°æ®æç¤º */
        .empty-data {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-tertiary);
            font-size: 13px;
        }
        
        .empty-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: #ddd;
        }
        
        /* æ–°å»ºæŒ‰é’® */
        .add-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 998;
        }
        
        /* æç¤ºæ¡† */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0,0,0,0.7);
            color: #fff;
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            visibility: visible;
        }
        
        /* å¯¼èˆªé¡µé¢æ ·å¼ */
        .navigation-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            z-index: 1002;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .navigation-page.show {
            transform: translateX(0);
        }
        
        .nav-header {
            height: 44px;
            line-height: 44px;
            background-color: var(--primary-color);
            color: #fff;
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .nav-page-title {
            font-size: 16px;
            font-weight: 500;
        }
        
        .nav-close {
            font-size: 18px;
            cursor: pointer;
        }
        
        .nav-content {
            padding: 15px;
            height: calc(100% - 44px);
            overflow-y: auto;
        }
        
        .nav-step1, .nav-step2 {
            background-color: #fff;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 16px;
            box-shadow: var(--card-shadow);
        }
        
        .nav-step-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            color: var(--text-color);
            display: flex;
            align-items: center;
        }
        
        .nav-step-title::before {
            content: '';
            display: inline-block;
            width: 3px;
            height: 16px;
            background-color: var(--primary-color);
            margin-right: 8px;
            border-radius: 1px;
        }
        
        .landmark-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .landmark-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        .landmark-address {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .map-thumbnail {
            width: 100%;
            height: 180px;
            border-radius: 8px;
            background-color: #f5f5f5;
            background-image: url('https://api.map.baidu.com/images/map.gif');
            background-size: cover;
            background-position: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .map-thumbnail::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background-color: var(--danger-color);
            border-radius: 50%;
            box-shadow: 0 0 0 4px rgba(255, 77, 79, 0.3);
        }
        
        .app-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .app-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid #eee;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .app-item:hover {
            background-color: #f8f8f8;
            border-color: #ddd;
        }
        
        .app-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .amap {
            background-color: #00b4ff;
        }
        
        .bmap {
            background-color: #3072f6;
        }
        
        .tmap {
            background-color: #00c264;
        }
        
        .app-name {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        /* å¯¼èˆªç¬¬äºŒæ­¥æ ·å¼ */
        .nav-map-container {
            width: 100%;
            height: 240px;
            border-radius: 10px;
            background-color: #f5f5f5;
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .current-position {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background-color: var(--primary-color);
            border-radius: 50%;
            box-shadow: 0 0 0 4px rgba(47, 128, 237, 0.3);
            z-index: 2;
        }
        
        .target-position {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background-color: var(--danger-color);
            border-radius: 50%;
            box-shadow: 0 0 0 4px rgba(255, 77, 79, 0.3);
            z-index: 2;
        }
        
        .direction-line {
            position: absolute;
            bottom: 50px;
            left: 50%;
            width: 2px;
            height: 120px;
            background-color: var(--warning-color);
            transform-origin: bottom center;
            transform: translateX(-50%);
            z-index: 1;
        }
        
        .compass-mode {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 48px;
            height: 48px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 3;
        }
        
        .navigation-instructions {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .instruction-title {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-color);
        }
        
        .instruction-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .distance-info {
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 500;
            margin-top: 8px;
        }
        
        .nav-action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .nav-action-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 15px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .btn-next {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-finish {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-back {
            background-color: #f5f5f5;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="nav-bar">
        <div class="nav-back" onclick="navigateTo('index.html')">â†</div>
        <div>ååŠ©ç”³è¯·çº¿ç´¢æŸ¥è¯¢</div>
        <div class="nav-right" onclick="showAddModal()">æ–°å»º</div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content">
        <!-- ç­›é€‰åŒºåŸŸ -->
        <div class="filter-bar">
            <div class="filter-row">
                <div class="filter-item">
                    <label class="filter-label">æ—¥æœŸ</label>
                    <input type="date" class="filter-input" id="filterDate" oninput="filterClues()">
                </div>
                <div class="filter-item">
                    <label class="filter-label">å§“å</label>
                    <input type="text" class="filter-input" id="filterName" placeholder="è¯·è¾“å…¥" oninput="filterClues()">
                </div>
                <div class="filter-item">
                    <label class="filter-label">è¡—é“/ä¹¡é•‡</label>
                    <select class="filter-select" id="filterStreet" onchange="onStreetChange()">
                        <option value="">å…¨éƒ¨</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="filter-label">ç¤¾åŒº/æ‘å±¯</label>
                    <select class="filter-select" id="filterCommunity" onchange="onCommunityChange()">
                        <option value="">å…¨éƒ¨</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="filter-label">å°åŒº/è‡ªç„¶æ‘</label>
                    <select class="filter-select" id="filterCell" onchange="filterClues()">
                        <option value="">å…¨éƒ¨</option>
                    </select>
                </div>
            </div>
            <div class="filter-actions">
                <button class="filter-btn btn-reset" onclick="resetFilter()">é‡ç½®</button>
            </div>
        </div>

        <!-- çº¿ç´¢åˆ—è¡¨ -->
        <div class="clue-list">
            <div class="list-header">
                <div class="col-date">æ—¥æœŸ</div>
                <div class="col-name">å§“å</div>
                <div class="col-family">å¤±èƒ½ç­‰çº§</div>
                <div class="col-community">ç¤¾åŒº/æ‘é•‡</div>
                <div class="col-address">è¯¦ç»†åœ°å€</div>
                <div class="col-phone">è”ç³»ç”µè¯</div>
                <div class="col-source">çº¿ç´¢æ¥æº</div>
                <div class="col-action">æ“ä½œ</div>
            </div>
            <div id="clueListContainer">
                <!-- åˆ—è¡¨æ•°æ®é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <!-- æ–°å»ºæŒ‰é’® -->
    <div class="add-btn" onclick="showAddModal()">+</div>

    <!-- è¯¦æƒ…å¼¹çª— -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="detailModalTitle">æŸ¥çœ‹ååŠ©ç”³è¯·çº¿ç´¢</div>
                <div class="modal-close" onclick="hideDetailModal()">Ã—</div>
            </div>
            <div class="modal-body">
                <div class="detail-form-row">
                    <!-- å·¦åˆ— -->
                    <div class="detail-form-col">
                    <div class="detail-form-item">
                        <div class="detail-label">å§“å</div>
                            <div style="flex: 1;">
                                <input type="text" class="detail-input" id="detailName" readonly>
                                <div class="readonly-tag">(ä¸å¯ä¿®æ”¹,éœ€è”ç³»æœºæ„ç®¡ç†å‘˜)</div>
                    </div>
                    </div>
                    <div class="detail-form-item">
                            <div class="detail-label">å®¶å±å§“å</div>
                            <div style="flex: 1;">
                                <input type="text" class="detail-input" id="detailFamilyName">
                            </div>
                    </div>
                    <div class="detail-form-item">
                            <div class="detail-label">ç¤¾åŒº/æ‘é•‡</div>
                            <div style="flex: 1;">
                                <input type="text" class="detail-input" id="detailCommunity">
                    </div>
                </div>
                    <div class="detail-form-item">
                            <div class="detail-label">è¯¦ç»†åœ°å€</div>
                            <div style="flex: 1; display: flex; align-items: center; gap: 8px;">
                                <input type="text" class="detail-input" id="detailAddress" style="flex: 1;">
                                <button onclick="openNavigationFromDetail()" style="padding: 4px 12px; background: var(--primary-color); color: #fff; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">å¯¼èˆª</button>
                            </div>
                    </div>
                    <div class="detail-form-item">
                            <div class="detail-label">å¤‡æ³¨</div>
                            <div style="flex: 1;">
                                <textarea class="detail-textarea" id="detailRemark" placeholder="å¦‚:éœ€å‘¨æœ«ä¸Šé—¨ååŠ©ç”³è¯·"></textarea>
                    </div>
                </div>
                    </div>
                    
                    <!-- å³åˆ— -->
                    <div class="detail-form-col">
                    <div class="detail-form-item">
                            <div class="detail-label">å¤±èƒ½ç­‰çº§</div>
                            <div style="flex: 1;">
                                <input type="text" class="detail-input" id="detailLevel" readonly>
                            </div>
                    </div>
                    <div class="detail-form-item">
                            <div class="detail-label">è”ç³»ç”µè¯</div>
                            <div style="flex: 1; display: flex; align-items: center; gap: 8px;">
                                <input type="text" class="detail-input" id="detailPhone" style="flex: 1;">
                                <a href="#" id="detailPhoneLink" style="color: var(--primary-color); text-decoration: none; font-size: 16px;">ğŸ“</a>
                            </div>
                    </div>
                    <div class="detail-form-item">
                            <div class="detail-label">çº¿ç´¢æ¥æº</div>
                            <div style="flex: 1;">
                                <input type="text" class="detail-input" id="detailSource">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="modal-btn btn-cancel" onclick="hideDetailModal()">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å»ºçº¿ç´¢å¼¹çª— -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">æ–°å»ºæœåŠ¡å¯¹è±¡</div>
                <div class="modal-close" onclick="hideAddModal()">Ã—</div>
            </div>
            <div class="tabs">
                <div class="tab-item active" onclick="switchTab('objectInfo')">æœåŠ¡å¯¹è±¡ä¿¡æ¯</div>
                <div class="tab-item" onclick="switchTab('familyInfo')">å®¶å±ä¿¡æ¯</div>
            </div>
            <div class="modal-body">
                <div class="tab-content">
                    <div class="tab-pane active" id="objectInfo">
                        <div class="detail-form-item">
                            <div class="detail-label">å§“å</div>
                            <div style="display: flex; align-items: center; flex: 1;">
                                <input type="text" class="detail-input" id="addName" placeholder="è¯·è¾“å…¥">
                                <svg class="scan-icon" viewBox="0 0 24 24" onclick="scanIdCard()"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 009.5 3 6.5 6.5 0 003 9.5 6.5 6.5 0 009.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
                            </div>
                        </div>
                        <div class="detail-form-item">
                            <div class="detail-label">èº«ä»½è¯å·</div>
                            <div style="display: flex; align-items: center; flex: 1;">
                                <input type="text" class="detail-input" id="addIdCard" placeholder="è¯·è¾“å…¥">
                                <svg class="scan-icon" viewBox="0 0 24 24" onclick="scanIdCard()"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 009.5 3 6.5 6.5 0 003 9.5 6.5 6.5 0 009.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
                            </div>
                        </div>
                        <div class="detail-form-item">
                            <div class="detail-label">è”ç³»ç”µè¯</div>
                            <input type="text" class="detail-input" id="addPhone" placeholder="è¯·è¾“å…¥">
                        </div>
                        <div class="detail-form-item">
                            <div class="detail-label">ç¤¾åŒº/æ‘é•‡</div>
                            <select class="detail-input" id="addCommunity">
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="å¹¸ç¦ç¤¾åŒº">å¹¸ç¦ç¤¾åŒº</option>
                                <option value="å¹³å®‰æ‘é•‡">å¹³å®‰æ‘é•‡</option>
                                <option value="å’Œè°å°åŒº">å’Œè°å°åŒº</option>
                                <option value="é˜³å…‰æ‘">é˜³å…‰æ‘</option>
                            </select>
                        </div>
                        <div class="detail-form-item">
                            <div class="detail-label">å…·ä½“åœ°å€</div>
                            <div style="display: flex; align-items: center; flex: 1;">
                                <input type="text" class="detail-input" id="addAddress" placeholder="è¯·è¾“å…¥">
                            </div>
                        </div>
                        <div class="detail-form-item">
                            <div class="detail-label">åœ°æ ‡ä½ç½®</div>
                            <input type="text" class="detail-input" id="addLandmark" placeholder="ä¾‹å¦‚ï¼šå°åŒºä¸œé—¨ã€æ‘å§”ä¼šæ—">
                        </div>
                    </div>
                    <div class="tab-pane" id="familyInfo">
                        <div class="detail-form-item">
                            <div class="detail-label">å®¶å±å§“å</div>
                            <input type="text" class="detail-input" id="addFamilyName" placeholder="è¯·è¾“å…¥">
                        </div>
                        <div class="detail-form-item">
                            <div class="detail-label">å®¶å±ç”µè¯</div>
                            <input type="text" class="detail-input" id="addFamilyPhone" placeholder="è¯·è¾“å…¥">
                        </div>
                        <div class="detail-form-item">
                            <div class="detail-label">å…³ç³»</div>
                            <input type="text" class="detail-input" id="addRelation" placeholder="è¯·è¾“å…¥">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="hideAddModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-confirm" onclick="submitNewClue()">æäº¤</button>
            </div>
        </div>
    </div>

    <!-- ä¿®æ”¹ç¡®è®¤å¼¹çª— -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="width: 80%; max-width: 300px;">
            <div class="modal-header">
                <div class="modal-title">ç¡®è®¤ä¿®æ”¹</div>
                <div class="modal-close" onclick="hideConfirmModal()">Ã—</div>
            </div>
            <div class="modal-body" style="text-align: center; padding: 20px 15px;">
                ç¡®å®šè¦ä¿®æ”¹è¯¥å­—æ®µå—ï¼Ÿä¿®æ”¹åå°†å®æ—¶æ›´æ–°æ•°æ®ã€‚
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-cancel" onclick="hideConfirmModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-confirm" onclick="confirmEdit()">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªé¡µé¢ -->
    <div class="navigation-page" id="navigationPage">
        <div class="nav-header">
            <div class="nav-close" onclick="closeNavigation()">Ã—</div>
            <div class="nav-page-title">å¯¼èˆªå‰å¾€</div>
            <div></div>
        </div>
        <div class="nav-content">
            <!-- å¯¼èˆªç¬¬ä¸€æ­¥ï¼šå¤–éƒ¨å¯¼èˆªè‡³åœ°æ ‡ -->
            <div id="navStep1" class="nav-step1">
                <div class="nav-step-title">ç¬¬ä¸€æ­¥ï¼šå‰å¾€åœ°æ ‡ä½ç½®</div>
                
                <div class="landmark-info">
                    <div class="landmark-name" id="navLandmarkName">å°åŒºä¸œé—¨</div>
                    <div class="landmark-address" id="navFullAddress">å®‰å¾½çœåˆè‚¥å¸‚åºé˜³åŒºå¹¸ç¦ç¤¾åŒº1æ ‹2å•å…ƒ301å®¤</div>
                </div>
                
                <div class="map-thumbnail" id="navMapThumbnail"></div>
                
                <div class="app-selector">
                    <div class="app-item" onclick="openExternalMap('amap')">
                        <div class="app-icon amap">é«˜</div>
                        <div class="app-name">é«˜å¾·åœ°å›¾</div>
                    </div>
                    <div class="app-item" onclick="openExternalMap('bmap')">
                        <div class="app-icon bmap">ç™¾</div>
                        <div class="app-name">ç™¾åº¦åœ°å›¾</div>
                    </div>
                    <div class="app-item" onclick="openExternalMap('tmap')">
                        <div class="app-icon tmap">è…¾</div>
                        <div class="app-name">è…¾è®¯åœ°å›¾</div>
                    </div>
                </div>
                
                <div class="nav-action-buttons">
                    <button class="nav-action-btn btn-back" onclick="closeNavigation()">å–æ¶ˆå¯¼èˆª</button>
                    <button class="nav-action-btn btn-next" onclick="goToNavStep2()">åˆ°è¾¾åœ°æ ‡ï¼Œç»§ç»­å¯¼èˆª</button>
                </div>
            </div>
            
            <!-- å¯¼èˆªç¬¬äºŒæ­¥ï¼šæœ€åä¸€å…¬é‡Œå¯¼èˆª -->
            <div id="navStep2" class="nav-step2" style="display: none;">
                <div class="nav-step-title">ç¬¬äºŒæ­¥ï¼šæœ€åä¸€å…¬é‡Œå¯¼èˆª</div>
                
                <div class="nav-map-container">
                    <div class="current-position"></div>
                    <div class="direction-line"></div>
                    <div class="target-position"></div>
                    <div class="compass-mode">ğŸ§­</div>
                </div>
                
                <div class="navigation-instructions">
                    <div class="instruction-title">å¯¼èˆªæŒ‡å¼•</div>
                    <div class="instruction-text" id="navInstructionText">
                        å‘ä¸œæ­¥è¡Œ50ç±³ï¼Œå·¦è½¬è¿›å…¥3å·æ¥¼å•å…ƒé—¨ï¼Œç›®çš„åœ°åœ¨å³ä¾§ç¬¬äºŒæˆ·ã€‚
                    </div>
                    <div class="distance-info" id="navDistanceInfo">
                        è·ç¦»ç›®æ ‡ä½ç½®çº¦80ç±³
                    </div>
                </div>
                
                <div class="nav-action-buttons">
                    <button class="nav-action-btn btn-back" onclick="backToNavStep1()">è¿”å›ä¸Šä¸€æ­¥</button>
                    <button class="nav-action-btn btn-finish" onclick="completeNavigation()">å¯¼èˆªå®Œæˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¡† -->
    <div class="toast" id="toast">æ“ä½œæˆåŠŸ</div>

    <script>
        // æ¨¡æ‹ŸåŸå§‹çº¿ç´¢æ•°æ®ï¼ˆæŒ‰ä¸Šä¼ æ—¶é—´å€’åºï¼‰
        const originalClues = [
            { id: 1, date: '2025-06-15', name: 'å¼ ä¸‰', familyName: 'å¼ å°æ˜', community: 'å¹¸ç¦ç¤¾åŒº', address: '1æ ‹2å•å…ƒ301å®¤', 
              phone: '138XXXX1234', idCard: '34012319900101XXXX', source: 'ç¤¾åŒº', remark: '', level: 'é‡åº¦å¤±èƒ½ï¼ˆä¸‰çº§ï¼‰' },
            { id: 2, date: '2025-06-14', name: 'æå››', familyName: 'æäº”', community: 'è¥¿æ¹–åŒºXXç¤¾åŒº', address: 'è¥¿æ¹–åŒºXXè¡—é“XXå°åŒº3æ ‹502å®¤', 
              phone: '13812345678', idCard: '330101********1234', source: 'ç¤¾åŒº', remark: 'å¦‚:éœ€å‘¨æœ«ä¸Šé—¨ååŠ©ç”³è¯·', level: 'ä¸­åº¦å¤±èƒ½ï¼ˆäºŒçº§ï¼‰' },
            { id: 3, date: '2025-06-14', name: 'ç‹äº”', familyName: 'ç‹å¼º', community: 'å’Œè°å°åŒº', address: '3æ ‹5å•å…ƒ102å®¤', 
              phone: '135XXXX6789', idCard: '34012319780923XXXX', source: 'åŒ»é™¢', remark: '', level: 'è½»åº¦å¤±èƒ½ï¼ˆä¸€çº§ï¼‰' },
            { id: 4, date: '2025-06-13', name: 'èµµå…­', familyName: 'èµµæ•', community: 'é˜³å…‰æ‘', address: 'æ‘å§”ä¼šæ—', 
              phone: '133XXXX2345', idCard: '34012319820315XXXX', source: 'ç¤¾åŒº', remark: '', level: 'é‡åº¦å¤±èƒ½ï¼ˆä¸‰çº§ï¼‰' },
            { id: 5, date: '2025-06-12', name: 'å­™ä¸ƒ', familyName: 'å­™ä¼Ÿ', community: 'å¹¸ç¦ç¤¾åŒº', address: '2æ ‹1å•å…ƒ501å®¤', 
              phone: '131XXXX5678', idCard: '34012319950708XXXX', source: 'è¡—é“', remark: '', level: 'ä¸­åº¦å¤±èƒ½ï¼ˆäºŒçº§ï¼‰' }
        ];

        let currentClues = [...originalClues]; // å½“å‰ç­›é€‰åçš„çº¿ç´¢
        let currentDetailId = null; // å½“å‰æŸ¥çœ‹çš„çº¿ç´¢ID
        let editingField = null; // å½“å‰æ­£åœ¨ç¼–è¾‘çš„å­—æ®µ
        let originalValue = ''; // å­—æ®µåŸå§‹å€¼
        let currentNavigation = {
            id: '',
            name: '',
            address: '',
            community: '',
            landmark: '',
            step: 1
        };

        // ä¸‰çº§åœ°å€çº§è”æ•°æ®ï¼ˆè¡—é“/ä¹¡é•‡ -> ç¤¾åŒº/æ‘å±¯ -> å°åŒº/è‡ªç„¶æ‘ï¼‰
        const regionData = {
            'XXè¡—é“': {
                'å¹¸ç¦ç¤¾åŒº': ['XXå°åŒº', 'YYå°åŒº'],
                'XXç¤¾åŒº': ['XXå°åŒº', 'YYå°åŒº']
            },
            'YYè¡—é“': {
                'å¹³å®‰æ‘é•‡': ['AAæ‘', 'BBæ‘'],
                'å’Œè°å°åŒº': ['å’Œè°å°åŒº']
            },
            'XXé•‡': {
                'é˜³å…‰æ‘': ['ä¸œæ‘', 'è¥¿æ‘']
            }
        };

        // åˆå§‹åŒ–åœ°å€çº§è”é€‰æ‹©
        function initRegionCascade() {
            const streetSelect = document.getElementById('filterStreet');
            const communitySelect = document.getElementById('filterCommunity');
            const cellSelect = document.getElementById('filterCell');
            
            // åˆå§‹åŒ–è¡—é“/ä¹¡é•‡é€‰é¡¹
            Object.keys(regionData).forEach(street => {
                const option = document.createElement('option');
                option.value = street;
                option.textContent = street;
                streetSelect.appendChild(option);
            });
        }

        // è¡—é“/ä¹¡é•‡å˜åŒ–æ—¶æ›´æ–°ç¤¾åŒº/æ‘å±¯é€‰é¡¹
        function onStreetChange() {
            const street = document.getElementById('filterStreet').value;
            const communitySelect = document.getElementById('filterCommunity');
            const cellSelect = document.getElementById('filterCell');
            
            // æ¸…ç©ºå¹¶é‡ç½®ç¤¾åŒº/æ‘å±¯å’Œå°åŒº/è‡ªç„¶æ‘
            communitySelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
            cellSelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
            
            if (street && regionData[street]) {
                Object.keys(regionData[street]).forEach(community => {
                    const option = document.createElement('option');
                    option.value = community;
                    option.textContent = community;
                    communitySelect.appendChild(option);
                });
            }
            
            filterClues();
        }

        // ç¤¾åŒº/æ‘å±¯å˜åŒ–æ—¶æ›´æ–°å°åŒº/è‡ªç„¶æ‘é€‰é¡¹
        function onCommunityChange() {
            const street = document.getElementById('filterStreet').value;
            const community = document.getElementById('filterCommunity').value;
            const cellSelect = document.getElementById('filterCell');
            
            // æ¸…ç©ºå¹¶é‡ç½®å°åŒº/è‡ªç„¶æ‘
            cellSelect.innerHTML = '<option value="">å…¨éƒ¨</option>';
            
            if (street && community && regionData[street] && regionData[street][community]) {
                regionData[street][community].forEach(cell => {
                    const option = document.createElement('option');
                    option.value = cell;
                    option.textContent = cell;
                    cellSelect.appendChild(option);
                });
            }
            
            filterClues();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initRegionCascade();
            // æ¨¡æ‹ŸåŠ è½½å»¶è¿Ÿ
            setTimeout(() => {
                renderClueList();
            }, 500);
        };

        // æ¸²æŸ“çº¿ç´¢åˆ—è¡¨
        function renderClueList() {
            const container = document.getElementById('clueListContainer');
            container.innerHTML = '';
            
            if (currentClues.length === 0) {
                container.innerHTML = `
                    <div class="empty-data">
                        <div class="empty-icon">ğŸ“„</div>
                        <div>æš‚æ— ç¬¦åˆæ¡ä»¶çš„çº¿ç´¢</div>
                    </div>
                `;
                return;
            }
            
            currentClues.forEach(clue => {
                const item = document.createElement('div');
                item.className = 'list-item';
                const fullAddress = `${clue.community}${clue.address}`;
                item.innerHTML = `
                    <div class="col-date">${clue.date}</div>
                    <div class="col-name">${clue.name}</div>
                    <div class="col-family">${clue.level || '-'}</div>
                    <div class="col-community">${clue.community}</div>
                    <div class="col-address">${clue.address}</div>
                    <div class="col-phone" style="display: flex; align-items: center; gap: 4px;">
                        <span>${clue.phone || '-'}</span>
                        ${clue.phone ? `<a href="tel:${clue.phone.replace(/\s/g, '').replace(/X/g, '0')}" style="color: var(--primary-color); text-decoration: none; font-size: 12px;">ğŸ“</a>` : ''}
                    </div>
                    <div class="col-source">${clue.source || '-'}</div>
                    <div class="col-action">
                        <div class="view-btn" onclick="showDetailModal(${clue.id})">æŸ¥çœ‹</div>
                        <div class="nav-btn" onclick="startNavigation(${clue.id})">å¯¼èˆª</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // ç­›é€‰çº¿ç´¢
        function filterClues() {
            const date = document.getElementById('filterDate').value;
            const name = document.getElementById('filterName').value.toLowerCase();
            const street = document.getElementById('filterStreet').value;
            const community = document.getElementById('filterCommunity').value;
            const cell = document.getElementById('filterCell').value;
            
            currentClues = originalClues.filter(clue => {
                let match = true;
                
                if (date && clue.date !== date) match = false;
                if (name && !clue.name.toLowerCase().includes(name)) match = false;
                
                // ä¸‰çº§åœ°å€ç­›é€‰ï¼šå¦‚æœé€‰æ‹©äº†è¡—é“ï¼Œåˆ™å¿…é¡»åŒ¹é…è¡—é“ï¼›å¦‚æœé€‰æ‹©äº†ç¤¾åŒºï¼Œåˆ™å¿…é¡»åŒ¹é…ç¤¾åŒºï¼›å¦‚æœé€‰æ‹©äº†å°åŒºï¼Œåˆ™å¿…é¡»åŒ¹é…å°åŒº
                // æ”¯æŒåªé€‰æ‹©å‰ä¸€çº§æˆ–å‰äºŒçº§
                if (street) {
                    // æ£€æŸ¥çº¿ç´¢çš„åœ°å€æ˜¯å¦åŒ…å«è¯¥è¡—é“
                    const addressMatch = clue.address.includes(street) || clue.community.includes(street);
                    if (!addressMatch) {
                        // å¦‚æœè¿˜é€‰æ‹©äº†ç¤¾åŒºï¼Œéœ€è¦æ›´ç²¾ç¡®åŒ¹é…
                        if (community) {
                            if (!clue.community.includes(community)) match = false;
                        } else {
                            match = false;
                        }
                    } else if (community) {
                        if (!clue.community.includes(community)) match = false;
                        if (cell && !clue.address.includes(cell)) match = false;
                    } else if (cell) {
                        if (!clue.address.includes(cell)) match = false;
                    }
                } else if (community) {
                    if (!clue.community.includes(community)) match = false;
                    if (cell && !clue.address.includes(cell)) match = false;
                } else if (cell) {
                    if (!clue.address.includes(cell)) match = false;
                }
                
                return match;
            });
            
            renderClueList();
        }

        // é‡ç½®ç­›é€‰æ¡ä»¶
        function resetFilter() {
            document.getElementById('filterDate').value = '';
            document.getElementById('filterName').value = '';
            document.getElementById('filterStreet').value = '';
            document.getElementById('filterCommunity').value = '';
            document.getElementById('filterCell').value = '';
            
            // é‡ç½®çº§è”é€‰æ‹©
            document.getElementById('filterCommunity').innerHTML = '<option value="">å…¨éƒ¨</option>';
            document.getElementById('filterCell').innerHTML = '<option value="">å…¨éƒ¨</option>';
            
            currentClues = [...originalClues];
            renderClueList();
        }

        // æ˜¾ç¤ºè¯¦æƒ…å¼¹çª—
        function showDetailModal(id) {
            currentDetailId = id;
            const clue = originalClues.find(item => item.id === id);
            
            if (clue) {
                // è®¾ç½®æ ‡é¢˜
                document.getElementById('detailModalTitle').textContent = `æŸ¥çœ‹ååŠ©ç”³è¯·çº¿ç´¢ - ${clue.name}`;
                
                // å¡«å……è¡¨å•å­—æ®µ
                document.getElementById('detailName').value = clue.name;
                document.getElementById('detailLevel').value = clue.level || '';
                document.getElementById('detailPhone').value = clue.phone;
                // æ›´æ–°ç”µè¯é“¾æ¥
                const phoneLink = document.getElementById('detailPhoneLink');
                if (clue.phone) {
                    const phoneNumber = clue.phone.replace(/\s/g, '').replace(/X/g, '0');
                    phoneLink.href = `tel:${phoneNumber}`;
                    phoneLink.style.display = 'block';
                } else {
                    phoneLink.style.display = 'none';
                }
                document.getElementById('detailFamilyName').value = clue.familyName || '';
                document.getElementById('detailCommunity').value = clue.community;
                document.getElementById('detailAddress').value = clue.address;
                document.getElementById('detailSource').value = clue.source || '';
                document.getElementById('detailRemark').value = clue.remark || '';
            }
            
            document.getElementById('detailModal').classList.add('show');
        }

        // éšè—è¯¦æƒ…å¼¹çª—
        function hideDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
        }

        // å¯ç”¨ç¼–è¾‘
        function enableEdit(field) {
            editingField = field;
            const element = document.getElementById(`detail${field.charAt(0).toUpperCase() + field.slice(1)}`);
            originalValue = element.textContent;
            
            document.getElementById('confirmModal').classList.add('show');
        }

        // ç¡®è®¤ç¼–è¾‘
        function confirmEdit() {
            hideConfirmModal();
            
            if (!editingField) return;
            
            const fieldId = `detail${editingField.charAt(0).toUpperCase() + editingField.slice(1)}`;
            const element = document.getElementById(fieldId);
            const currentValue = element.textContent;
            
            // å°†æ–‡æœ¬èŠ‚ç‚¹æ›¿æ¢ä¸ºè¾“å…¥æ¡†
            element.innerHTML = `<input type="text" class="detail-input" id="editInput" value="${currentValue}">`;
            
            // èšç„¦è¾“å…¥æ¡†
            setTimeout(() => {
                document.getElementById('editInput').focus();
            }, 100);
        }

        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            if (editingField && originalValue) {
                const fieldId = `detail${editingField.charAt(0).toUpperCase() + editingField.slice(1)}`;
                document.getElementById(fieldId).textContent = originalValue;
            }
            
            editingField = null;
            originalValue = '';
        }

        // ä¿å­˜è¯¦æƒ…ä¿®æ”¹
        function saveDetail() {
            if (editingField) {
                const input = document.getElementById('editInput');
                if (input) {
                    const newValue = input.value.trim();
                    if (newValue) {
                        // æ›´æ–°æ˜¾ç¤º
                        input.parentElement.textContent = newValue;
                        
                        // æ›´æ–°æ•°æ®æº
                        const clueIndex = originalClues.findIndex(item => item.id === currentDetailId);
                        if (clueIndex !== -1) {
                            originalClues[clueIndex][editingField] = newValue;
                            
                            // å¦‚æœç¼–è¾‘çš„æ˜¯åœ°å€ç›¸å…³å­—æ®µï¼ŒåŒæ­¥æ›´æ–°ç­›é€‰åçš„åˆ—è¡¨
                            if (editingField === 'community' || editingField === 'address' || editingField === 'landmark') {
                                filterClues();
                            }
                        }
                        
                        showToast('ä¿®æ”¹æˆåŠŸ');
                    } else {
                        showToast('è¯·è¾“å…¥æœ‰æ•ˆå†…å®¹');
                        return;
                    }
                }
            }
            
            editingField = null;
            originalValue = '';
            hideDetailModal();
        }

        // æ˜¾ç¤ºæ–°å»ºå¼¹çª—
        function showAddModal() {
            // æ¸…ç©ºè¡¨å•
            document.getElementById('addName').value = '';
            document.getElementById('addIdCard').value = '';
            document.getElementById('addPhone').value = '';
            document.getElementById('addCommunity').value = '';
            document.getElementById('addAddress').value = '';
            document.getElementById('addLandmark').value = '';
            document.getElementById('addFamilyName').value = '';
            document.getElementById('addFamilyPhone').value = '';
            document.getElementById('addRelation').value = '';
            
            // åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µ
            switchTab('objectInfo');
            
            document.getElementById('addModal').classList.add('show');
        }

        // éšè—æ–°å»ºå¼¹çª—
        function hideAddModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabId) {
            // åˆ‡æ¢æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // æäº¤æ–°å»ºçº¿ç´¢
        function submitNewClue() {
            const name = document.getElementById('addName').value.trim();
            const phone = document.getElementById('addPhone').value.trim();
            const community = document.getElementById('addCommunity').value;
            const address = document.getElementById('addAddress').value.trim();
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!name) {
                showToast('è¯·è¾“å…¥å§“å');
                return;
            }
            if (!phone) {
                showToast('è¯·è¾“å…¥è”ç³»ç”µè¯');
                return;
            }
            if (!community) {
                showToast('è¯·é€‰æ‹©ç¤¾åŒº/æ‘é•‡');
                return;
            }
            if (!address) {
                showToast('è¯·è¾“å…¥å…·ä½“åœ°å€');
                return;
            }
            
            // ç”Ÿæˆæ–°ID
            const newId = Math.max(...originalClues.map(item => item.id)) + 1;
            
            // åˆ›å»ºæ–°çº¿ç´¢å¯¹è±¡
            const newClue = {
                id: newId,
                date: new Date().toISOString().split('T')[0], // å½“å‰æ—¥æœŸ
                name: name,
                familyName: document.getElementById('addFamilyName').value.trim() || '',
                community: community,
                address: address,
                landmark: document.getElementById('addLandmark').value.trim() || '',
                phone: phone,
                idCard: document.getElementById('addIdCard').value.trim() || '',
                status: 'å¾…ä¸Šé—¨ååŠ©ç”³è¯·',
                familyPhone: document.getElementById('addFamilyPhone').value.trim() || '',
                relation: document.getElementById('addRelation').value.trim() || ''
            };
            
            // æ·»åŠ åˆ°æ•°æ®æºå¼€å¤´ï¼ˆæœ€æ–°æ•°æ®ç½®é¡¶ï¼‰
            originalClues.unshift(newClue);
            currentClues = [...originalClues];
            
            // åˆ·æ–°åˆ—è¡¨
            renderClueList();
            
            // å…³é—­å¼¹çª—
            hideAddModal();
            
            // æ˜¾ç¤ºæç¤º
            showToast('æ–°å»ºæˆåŠŸ');
        }

        // éšè—ç¡®è®¤å¼¹çª—
        function hideConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        // æ‹ç…§è¯†åˆ«èº«ä»½è¯
        function scanIdCard() {
            showToast('æ‹ç…§è¯†åˆ«åŠŸèƒ½å¼€å‘ä¸­');
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šè°ƒç”¨ç›¸æœºAPIæˆ–ç¬¬ä¸‰æ–¹è¯†åˆ«æœåŠ¡
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šè¿”å›ä¸Šä¸€é¡µ
            showToast('è¿”å›é¦–é¡µ');
        }

        // å¯¼èˆªåˆ°æŒ‡å®šé¡µé¢
        function navigateTo(url) {
            window.location.href = url;
        }

        // æ˜¾ç¤ºæç¤ºæ¡†
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // å¼€å§‹å¯¼èˆª
        function startNavigation(id) {
            const clue = originalClues.find(item => item.id === id);
            if (!clue) return;
            
            currentNavigation.id = id;
            currentNavigation.name = clue.name;
            currentNavigation.address = clue.address;
            currentNavigation.community = clue.community;
            currentNavigation.landmark = clue.landmark || clue.address;
            currentNavigation.step = 1;
            
            // æ›´æ–°å¯¼èˆªé¡µé¢ä¿¡æ¯
            document.getElementById('navLandmarkName').textContent = currentNavigation.landmark;
            document.getElementById('navFullAddress').textContent = `å®‰å¾½çœåˆè‚¥å¸‚${currentNavigation.community}${currentNavigation.address}`;
            
            // æ ¹æ®ä¸åŒçš„åœ°æ ‡è®¾ç½®ä¸åŒçš„å¯¼èˆªæŒ‡å¼•
            let instructionText = '';
            let distanceInfo = '';
            
            if (currentNavigation.landmark.includes('å°åŒº') || currentNavigation.community.includes('ç¤¾åŒº')) {
                instructionText = 'å‘ä¸œæ­¥è¡Œ50ç±³ï¼Œå·¦è½¬è¿›å…¥3å·æ¥¼å•å…ƒé—¨ï¼Œç›®çš„åœ°åœ¨å³ä¾§ç¬¬äºŒæˆ·ã€‚';
                distanceInfo = 'è·ç¦»ç›®æ ‡ä½ç½®çº¦80ç±³';
            } else if (currentNavigation.landmark.includes('æ‘') || currentNavigation.community.includes('æ‘')) {
                instructionText = 'å‘åŒ—æ­¥è¡Œ100ç±³ï¼Œç»è¿‡æ‘å§”ä¼šåå³è½¬ï¼Œæ²¿å°è·¯ç›´è¡Œè‡³ç¬¬ä¸‰æˆ·äººå®¶ã€‚';
                distanceInfo = 'è·ç¦»ç›®æ ‡ä½ç½®çº¦150ç±³';
            } else {
                instructionText = 'å‘å‰ç›´è¡Œ30ç±³ï¼Œå³è½¬è¿›å…¥ç¤¾åŒºå†…éƒ¨é“è·¯ï¼Œç¬¬äºŒæ ‹æ¥¼å³ä¸ºç›®çš„åœ°ã€‚';
                distanceInfo = 'è·ç¦»ç›®æ ‡ä½ç½®çº¦50ç±³';
            }
            
            document.getElementById('navInstructionText').textContent = instructionText;
            document.getElementById('navDistanceInfo').textContent = distanceInfo;
            
            // æ˜¾ç¤ºå¯¼èˆªé¡µé¢
            document.getElementById('navigationPage').classList.add('show');
            document.getElementById('navStep1').style.display = 'block';
            document.getElementById('navStep2').style.display = 'none';
        }

        // ä»è¯¦æƒ…é¡µå¼€å§‹å¯¼èˆª
        function startNavigationFromDetail() {
            if (currentDetailId) {
                startNavigation(currentDetailId);
                hideDetailModal();
            }
        }

        // å…³é—­å¯¼èˆªé¡µé¢
        function closeNavigation() {
            document.getElementById('navigationPage').classList.remove('show');
        }

        // æ‰“å¼€å¤–éƒ¨åœ°å›¾åº”ç”¨
        function openExternalMap(appType) {
            const landmark = encodeURIComponent(currentNavigation.landmark);
            const address = encodeURIComponent(`å®‰å¾½çœåˆè‚¥å¸‚${currentNavigation.community}${currentNavigation.address}`);
            
            let url = '';
            
            switch(appType) {
                case 'amap':
                    // é«˜å¾·åœ°å›¾URI
                    url = `amapuri://route/plan/?dlat=&dlon=&dname=${landmark}&dev=0&t=0`;
                    break;
                case 'bmap':
                    // ç™¾åº¦åœ°å›¾URI
                    url = `baidumap://map/direction?destination=${landmark}|${address}&mode=driving`;
                    break;
                case 'tmap':
                    // è…¾è®¯åœ°å›¾URI
                    url = `qqmap://map/routeplan?type=drive&to=${landmark}&tocoord=&referer=myapp`;
                    break;
            }
            
            // æ¨¡æ‹Ÿæ‰“å¼€å¤–éƒ¨åº”ç”¨
            showToast(`æ­£åœ¨æ‰“å¼€${appType === 'amap' ? 'é«˜å¾·åœ°å›¾' : appType === 'bmap' ? 'ç™¾åº¦åœ°å›¾' : 'è…¾è®¯åœ°å›¾'}...`);
            
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šè°ƒç”¨å¤–éƒ¨åœ°å›¾åº”ç”¨
            setTimeout(() => {
                showToast('å·²æ‰“å¼€åœ°å›¾åº”ç”¨ï¼Œå¯¼èˆªè‡³åœ°æ ‡ä½ç½®');
            }, 1500);
        }

        // è¿›å…¥å¯¼èˆªç¬¬äºŒæ­¥
        function goToNavStep2() {
            currentNavigation.step = 2;
            document.getElementById('navStep1').style.display = 'none';
            document.getElementById('navStep2').style.display = 'block';
            
            // æ¨¡æ‹Ÿè·å–å½“å‰ä½ç½®å’Œç›®æ ‡ä½ç½®çš„ç›¸å¯¹å…³ç³»
            updateCompassDirection();
        }

        // è¿”å›å¯¼èˆªç¬¬ä¸€æ­¥
        function backToNavStep1() {
            currentNavigation.step = 1;
            document.getElementById('navStep2').style.display = 'none';
            document.getElementById('navStep1').style.display = 'block';
        }

        // æ›´æ–°æŒ‡å—é’ˆæ–¹å‘
        function updateCompassDirection() {
            // æ¨¡æ‹ŸæŒ‡å—é’ˆæ–¹å‘å˜åŒ–
            const directionLine = document.querySelector('.direction-line');
            let angle = 0;
            
            const updateDirection = () => {
                angle = (angle + 1) % 360;
                directionLine.style.transform = `translateX(-50%) rotate(${angle}deg)`;
                
                // æ›´æ–°è·ç¦»ä¿¡æ¯
                const distance = Math.floor(Math.random() * 50) + 30;
                document.getElementById('navDistanceInfo').textContent = `è·ç¦»ç›®æ ‡ä½ç½®çº¦${distance}ç±³`;
                
                if (currentNavigation.step === 2) {
                    requestAnimationFrame(updateDirection);
                }
            };
            
            updateDirection();
        }

        // å®Œæˆå¯¼èˆª
        function completeNavigation() {
            showToast('å¯¼èˆªå®Œæˆï¼Œå·²åˆ°è¾¾ç›®çš„åœ°');
            setTimeout(() => {
                closeNavigation();
            }, 1500);
        }
        
        // ä»è¯¦æƒ…å¼¹çª—æ‰“å¼€å¯¼èˆª
        function openNavigationFromDetail() {
            const clue = originalClues.find(item => item.id === currentDetailId);
            if (clue && clue.address) {
                const fullAddress = `${clue.community}${clue.address}`;
                startNavigation(currentDetailId);
            } else {
                showToast('åœ°å€ä¿¡æ¯ä¸å®Œæ•´');
            }
        }
    </script>
</body>
</html>